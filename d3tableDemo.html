<!DOCTYPE html>
<html lang="en">
     <head>
        <title>D3 Table Demo</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

		<link rel="stylesheet" href="css/d3table.css" />
		 
        <script src="vendor/js/d3.js"></script>
		<script src="js/d3table.js"></script>
		 <style type="text/css">
			 .rightAlign {
				 text-align: right;
				 padding-right: 2em;
			 }
		 </style>
     </head>
    
     <body>
		 <h1>D3 Table</h1>
		 
		 <div id="putd3TableHere"></div>

        <script>
			function makeString () {
				return Math.random().toString(36).slice(2);
			};
			
			// headers is an array of key/value objects, keys must match property names in data
			// value settings can decide whether field is initially visible, and/or removable
			// correct type is also important for filtering and sorting
			var headerEntries = [
				{key: "id", value: {name: "id", visible: true, removable: true, type: "numeric"}},
				{key: "number", value: {name: "a number", visible: true, removable: true, type: "numeric"}},
				{key: "string", value: {name: "a string", visible: true, removable: true, type: "alpha"}},
				{key: "boolean", value: {name: "a boolean", visible: true, removable: true, type: "boolean", tooltip: "A Boolean Column"}},
			];
			// data is array of objects
			var data = d3.range(1,20000).map (function (d, i) {
				return {id: i+1, "number": Math.ceil (Math.random() * 5000), "string": makeString(), "boolean": Math.random() > .5}
			});
			
			var cellStyles = {
				number: "rightAlign"
			};
			
			var cellEventHooks = {
				string: function (cellSel) {
					cellSel
					.on ("mouseover", function (d,i) {
						d3.select("h1").text(d.value[d.key])	// here in cellEvent Hooks, d.key = field, d.values  = all field values for row that cell is in
					})
					.on ("mouseout", function (d,i) {
						d3.select("h1").text("D3 Table")	
					})
					;
				}
			};
			
			var modifiers = {
				id: function (d) { return "ID "+d.id; },	// here in modifiers, d is just object of values indexed by field
				number: function(d) { return d3.format(",")(d.number); },
			};
			
			var simpleTooltips = {
				string: function(d) { return d.value.string+" was randomly generated"; },
				id: function(d) { return d3.values(d.value).join(", "); },
			};
			
			var empowerRows = function (rowSelection) {
				// do stuff post rendering to row selection
			};
			
            var d3tab = d3.select("#putd3TableHere").attr("class", "d3tableContainer")
				.datum({
					data: data, 
					headerEntries: headerEntries, 
					cellStyles: cellStyles,
					eventHooks: cellEventHooks,
					tooltips: simpleTooltips,
					columnOrder: headerEntries.map (function (hentry) { return hentry.key; }),
				})
			;
			var table = CLMSUI.d3Table ();
			table (d3tab);

			// set initial filters
			var keyedFilters = {};
			headerEntries.forEach (function (hentry) {
				keyedFilters[hentry.key] = {value: "", type: hentry.value.type}	
			});

			table
				.filter (keyedFilters)
				.dataToHTMLModifiers (modifiers)
				.postUpdateFunc (empowerRows)
				.pageSize(10)
				.update()
			;
        </script>

    </body>
</html>
